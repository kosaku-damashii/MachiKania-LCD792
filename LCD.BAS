REM I2C TEST (AQM0802)

I2C 100:REM Set I2C Baudrate 100KHz
DIM D(1)
C=20: REM 0~63

GOSUB INIAQM
GOSUB PRTAQM,0,"123456789+-#$%&'"
GOSUB PRTAQM,1,"123456789+-#$%&'"
END


LABEL INIAQM
 REM Initialize AMQ0802
 I2CWRITE $3E,$00,$38:WAIT 1
 I2CWRITE $3E,$00,$39:WAIT 1
 I2CWRITE $3E,$00,$14:WAIT 1
 I2CWRITE $3E,$00,$70 OR (C AND 15):WAIT 1
 I2CWRITE $3E,$00,$5C OR (C >> 4 AND 3):WAIT 1
 I2CWRITE $3E,$00,$6C:WAIT 15
 I2CWRITE $3E,$00,$38:WAIT 1
 I2CWRITE $3E,$00,$01:WAIT 1
 I2CWRITE $3E,$00,$0C:WAIT 1
RETURN

LABEL PRTAQM
 REM Print String in line n
 VAR S
 I2CWRITE $3E,0,$80+((ARGS(1) AND 1)<<6):WAIT 1
 S=ARGS(2)
 WHILE PEEK(S)
  I2CWRITE $3E,$40,PEEK(S):WAIT 1
  S=S+1
 WEND
RETURN
